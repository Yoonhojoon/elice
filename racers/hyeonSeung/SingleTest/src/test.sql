-- orders 테이블 생성
CREATE TABLE orders (
    order_number VARCHAR(13) PRIMARY KEY,
    order_status VARCHAR(4),
    order_date DATETIME,
    cancel_date DATETIME,
    customer INT,
    delivery_rider INT,
    card_company INT
);

-- orders_detail 테이블 생성
CREATE TABLE orders_detail (
    sequence INT PRIMARY KEY,
    orders VARCHAR(13),
    product INT,
    order_count INT,
    pay_price INT,
    FOREIGN KEY (orders) REFERENCES orders(order_number)
);

-- card_company_manager 테이블 생성
CREATE TABLE card_company_manager (
    card_company_id INT PRIMARY KEY,
    company_name VARCHAR(255),
    fee DECIMAL(7,4),
    from_date DATETIME,
    to_date DATETIME
);



-- orders 테이블에 데이터 삽입
INSERT INTO orders (order_number, order_status, order_date, cancel_date, customer, delivery_rider, card_company) VALUES
('20220901A0001', '3001', '2022-08-29 16:10:57', NULL, 11, 1, 1),
('20220904A0001', '3001', '2022-09-04 17:57:23', NULL, 2, 2, 1),
('20220904A0002', '3001', '2022-09-04 18:10:57', NULL, 11, 3, 2),
('20220905A0001', '3001', '2022-09-05 20:00:00', NULL, 2, 3, 1),
('20220907A0001', '3001', '2022-09-07 19:07:22', NULL, 1, 4, 3),
('20220907A0002', '3001', '2022-09-07 20:11:21', NULL, 2, 2, 2),
('20220908A0001', '3001', '2022-09-08 12:05:54', NULL, 11, 1, 2),
('20220917A0001', '3001', '2022-09-17 11:10:41', NULL, 4, 3, 1),
('20220917A0002', '3001', '2022-09-17 15:07:56', NULL, 2, 4, 1),
('20220917A0003', '3001', '2022-09-17 22:39:23', NULL, 3, 5, 2),
('20220917A0004', '3001', '2022-09-17 22:39:00', NULL, 2, NULL, 2),
('20220920A0001', '3001', '2022-09-20 19:10:56', NULL, 5, 6, 2),
('20220920A0002', '3001', '2022-09-20 19:27:41', NULL, 1, 1, 1),
('20220920A0003', '3001', '2022-09-20 19:34:47', NULL, 2, 2, 1),
('20220921A0001', '3001', '2022-09-21 20:00:21', NULL, 11, 3, 2),
('20220922A0002', '3001', '2022-09-22 15:50:15', NULL, 8, 4, 3),
('20220922A0003', '3001', '2022-09-22 16:55:47', NULL, 1, 5, 4),
('20220922A0004', '3002', '2022-09-22 18:49:54', '2022-09-22 19:00:00', 9, 1, 4),
('20220922A0005', '3002', '2022-09-22 19:16:28', '2022-09-23 09:03:21', 10, 5, 2),
('20220922A0006', '3001', '2022-09-22 22:37:28', NULL, 10, 3, 2),
('20220922A0007', '3003', '2022-09-22 23:00:00', '2022-09-22 23:02:00', 9, NULL, 4),
('20220923A0001', '3001', '2022-09-23 19:13:21', NULL, 3, 6, 4),
('20220923A0002', '3001', '2022-09-23 20:00:21', NULL, 3, 1, 2),
('20220924A0001', '3001', '2022-09-24 21:48:21', NULL, 3, 2, 3),
('20220930A0001', '3001', '2022-09-30 19:19:32', NULL, 9, 2, 4),
('20220930A0002', '3001', '2022-09-30 21:17:28', NULL, 10, 3, 2);

-- orders_detail 테이블에 데이터 삽입
INSERT INTO orders_detail (sequence, orders, product, order_count, pay_price) VALUES
(1, '20220901A0001', 1, 2, 7600),
(2, '20220901A0001', 3, 1, 6200),
(3, '20220901A0001', 4, 1, 7800),
(4, '20220901A0001', 5, 1, 10900),
(5, '20220904A0001', 8, 2, 29000),
(6, '20220904A0001', 15, 1, 2000),
(7, '20220904A0002', 2, 1, 1450),
(8, '20220904A0002', 13, 1, 6000),
(9, '20220904A0002', 15, 1, 2000),
(10, '20220904A0002', 7, 1, 7000),
(11, '20220907A0001', 5, 1, 10900),
(12, '20220907A0001', 8, 2, 29000),
(13, '20220907A0001', 9, 1, 12000),
(14, '20220907A0002', 12, 3, 16500),
(15, '20220907A0002', 13, 3, 18000),
(16, '20220908A0001', 1, 1, 3800),
(17, '20220908A0001', 4, 2, 15600),
(18, '20220908A0001', 5, 2, 21800),
(19, '20220908A0001', 8, 1, 14500),
(20, '20220908A0001', 13, 3, 18000),
(21, '20220908A0001', 14, 3, 21000),
(22, '20220917A0001', 3, 3, 18600),
(23, '20220917A0002', 6, 3, 20100),
(24, '20220917A0002', 7, 2, 14000),
(25, '20220917A0002', 8, 3, 43500),
(26, '20220917A0003', 1, 3, 11400),
(27, '20220917A0003', 5, 2, 21800),
(28, '20220917A0003', 6, 1, 6700),
(29, '20220917A0003', 10, 1, 6000),
(30, '20220917A0003', 8, 1, 14500),
(31, '20220920A0001', 2, 3, 4350),
(32, '20220920A0001', 3, 3, 18600),
(33, '20220920A0002', 5, 2, 21800),
(34, '20220920A0002', 8, 5, 72500),
(35, '20220920A0002', 6, 1, 6700),
(36, '20220920A0002', 10, 1, 6000),
(37, '20220920A0002', 11, 1, 5000),
(38, '20220920A0003', 4, 2, 15600),
(39, '20220920A0003', 13, 2, 12000),
(40, '20220920A0003', 2, 2, 2900),
(41, '20220921A0001', 1, 10, 38000),
(42, '20220921A0001', 2, 5, 7250),
(43, '20220922A0002', 1, 3, 11400),
(44, '20220922A0002', 6, 2, 13400),
(45, '20220922A0002', 8, 1, 14500),
(46, '20220922A0002', 9, 1, 12000),
(47, '20220922A0002', 14, 1, 7000),
(48, '20220922A0003', 3, 3, 18600),
(49, '20220923A0001', 11, 1, 5000),
(50, '20220923A0001', 12, 1, 5500),
(51, '20220923A0002', 4, 1, 7800),
(52, '20220923A0002', 10, 10, 60000),
(53, '20220924A0001', 15, 5, 10000),
(54, '20220930A0001', 5, 5, 54500),
(55, '20220930A0001', 8, 3, 43500),
(56, '20220930A0002', 1, 2, 7600),
(57, '20220930A0002', 6, 5, 33500),
(58, '20220930A0002', 11, 3, 15000),
(59, '20220922A0004', 1, 2, 7600),
(60, '20220922A0004', 2, 2, 2900),
(61, '20220922A0004', 3, 2, 12400),
(62, '20220922A0005', 6, 3, 20100),
(63, '20220922A0005', 7, 3, 21000),
(64, '20220922A0006', 11, 3, 15000),
(65, '20220922A0006', 12, 3, 16500),
(66, '20220922A0007', 12, 3, 16500),
(67, '20220917A0004', 1, 2, 7600),
(68, '20220905A0001', 1, 2, 7600);

-- card_company_manager 테이블에 데이터 삽입
INSERT INTO card_company_manager (card_company_id, company_name, fee, from_date, to_date) VALUES
(1, '삼성카드', 1.3200, '2022-08-29 00:00:00', '2080-09-14 00:00:00'),
(2, '현대카드', 1.3200, '2022-08-29 00:00:00', '2080-09-14 00:00:00'),
(3, '신한카드', 3.3200, '2022-08-29 00:00:00', '2080-09-14 00:00:00'),
(4, '롯데카드', 3.3500, '2022-08-29 00:00:00', '2080-09-14 00:00:00');



--1. orders 테이블에서 주문 상태가 '3001'인 주문을 선택합니다.
--2. 이 주문들을 card_company_manager 테이블과 연결하여 각 주문의 카드 회사 정보를 가져옵니다.
--3. 그리고 orders_detail 테이블과 연결하여 각 주문의 세부 금액 정보를 가져옵니다.
--4. 각 주문 항목에 대해 지불 금액(pay_price)과 해당 카드 회사의 수수료율(fee)을 곱하여 수수료를 계산합니다.
--5. 이 수수료를 카드 회사별로 합산합니다.
--6. 합산된 수수료를 반올림하여 정수로 만듭니다.
--7. 결과를 카드 회사 ID별로 그룹화하여 보여줍니다.
--
--힌트 : round 함수는 반올림, sum 함수는 총합, 컬럼내 int타입 계산식 사용가능(예: price + 500)
